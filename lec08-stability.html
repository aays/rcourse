<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Madeleine Bonsma-Fisher" />


<title>Population models in 2 dimensions</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="image/favicon.png">
<style type="text/css">

table {
    border-collapse: collapse;
}

thead {
    border-top: solid #DCDCDC;
    border-bottom: solid #DCDCDC;
}

tr.odd {
    background-color: #F8F8F8;
}

tr:last-child {
    border-bottom: solid #DCDCDC;
}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}

.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EEB430H1</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-map-o"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lec01-introduction.html">Sept. 7: Intro to course, programming, RStudio, and R Markdown</a>
    </li>
    <li>
      <a href="lec02-basic-r.html">Sept. 12: Variable assignment, vectors, functions</a>
    </li>
    <li>
      <a href="lec03-basic-r.html">Sept. 14: Data frames, intro to dplyr</a>
    </li>
    <li>
      <a href="lec04-dplyr.html">Sept. 19: Data wrangling in dplyr, tidy data</a>
    </li>
    <li>
      <a href="lec05-dplyr.html">Sept. 21: More dplyr and tidy data, ggplot intro</a>
    </li>
    <li>
      <a href="lec06-pop-models.html">Sept. 26: Qualitative review of population models</a>
    </li>
    <li>
      <a href="lec07-pop-models.html">Sept. 28: Modelling in R</a>
    </li>
    <li>
      <a href="lec08-stability.html">Oct. 03: Population models in two dimensions</a>
    </li>
    <li>
      <a href="lec09-modeling-r.html">Oct. 05: Fixed points, null clines, and stability</a>
    </li>
    <li>
      <a href="lec10-modelling.html">Oct. 10: Fitting models to data</a>
    </li>
    <li>
      <a href="lec11-modelling.html">Oct. 12: Statistical and probabilistic modelling in R</a>
    </li>
    <li>
      <a href="lec12-datasets.html">Oct. 17: Scientific method, team dynamics, and project datasets</a>
    </li>
    <li>
      <a href="lec13-projects-r.html">Oct. 19: Project and Git in RStudio, and project work</a>
    </li>
    <li>
      <a href="lec14-git.html">Oct. 24: Scientific collaboration, Git and GitHub</a>
    </li>
    <li>
      <a href="lec15-data-viz.html">Oct. 26: Data visualization and project work</a>
    </li>
    <li>
      <a href="lec16-data-viz.html">Oct. 31: Project work, data visualizations</a>
    </li>
    <li>
      <a href="lec17-rmarkdown.html">Nov. 02: Reproducible workflow, Metadata, and R Markdown</a>
    </li>
    <li class="dropdown-header">Nov. 14: Project work (no lesson)</li>
    <li class="dropdown-header">Nov. 16: Project work (no lesson)</li>
    <li>
      <a href="lec20-publishing.html">Nov. 21: Preparing a scientific item for academic publishing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="assignment-01.html">Assignment 1</a>
    </li>
    <li>
      <a href="assignment-02.html">Assignment 2</a>
    </li>
    <li>
      <a href="assignment-03.html">Assignment 3</a>
    </li>
    <li>
      <a href="assignment-04.html">Assignment 4</a>
    </li>
    <li>
      <a href="assignment-05.html">Assignment 5</a>
    </li>
    <li>
      <a href="assignment-06.html">Assignment 6</a>
    </li>
    <li>
      <a href="assignment-07.html">Assignment 7</a>
    </li>
    <li>
      <a href="assignment-08.html">Assignment 8</a>
    </li>
    <li>
      <a href="assignment-final.html">Final assignment</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-caret-square-o-right"></span>
     
    Slides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="slides/lec12-datasets.html">Oct. 17: Scientific method, team dynamics, and project datasets</a>
    </li>
  </ul>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-question"></span>
     
    Resources and FAQ
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mailto:joel.ostblom@mail.utoronto.ca">
        <span class="fa fa-envelope"></span>
         
        Contact
      </a>
    </li>
    <li>
      <a href="https://github.com/uoftcoders/rcourse">
        <span class="fa fa-github"></span>
         
        GitHub
      </a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Population models in 2 dimensions</h1>
<h4 class="author"><em>Madeleine Bonsma-Fisher</em></h4>

</div>


<div id="lesson-preamble" class="section level2">
<h2>Lesson preamble</h2>
<blockquote>
<h3 id="learning-objectives">Learning objectives</h3>
<ul>
<li>Review numerically solving differential equations</li>
<li>Calculate and plot solutions with multiple initial conditions</li>
<li>Numerically solve two-dimensional models in R</li>
<li>Phase portraits of two-dimensional systems</li>
<li>Find fixed points for one-dimensional systems analytically (time permitting)</li>
</ul>
<h3 id="lesson-outline">Lesson outline</h3>
<p>Total lesson time: 2 hours</p>
<ul>
<li>Review drawing phase portraits and numerically solving equations in one dimension (10 min)</li>
<li>Numerical solutions with multiple initial conditions (15 min)</li>
<li>Qualitative analysis of two-dimensional models
<ul>
<li>Numerical solutions for two-dimensional models (15 min)</li>
<li>Phase portraits of two-dimensional systems by hand (20 min)</li>
<li>Using <code>phaseR</code> to create phase portraits in R (40 min)</li>
</ul></li>
<li>Finding fixed points analytically in one dimension (20 min)</li>
</ul>
<h3 id="setup">Setup</h3>
<ul>
<li><code>install.packages('phaseR')</code></li>
<li><code>install.packages('deSolve')</code></li>
<li><code>install.packages('ggplot2')</code> (or <code>tidyverse</code>)</li>
<li><code>install.packages('dplyr')</code> (or <code>tidyverse</code>)</li>
<li><code>install.packages('tidyr')</code> (or <code>tidyverse</code>)</li>
</ul>
</blockquote>
</div>
<div id="recap-from-last-week" class="section level2">
<h2>Recap from last week</h2>
<ul>
<li><p>Drawing <strong>phase portraits</strong> in one dimension:</p>
<ul>
<li>Fixed points: values of <span class="math inline">\(N\)</span> at which <span class="math inline">\(\frac{dN}{dt}\)</span>, the rate of change of <span class="math inline">\(N\)</span>, is <span class="math inline">\(0\)</span>. To find fixed points, plot <span class="math inline">\(\frac{dN}{dt}\)</span> vs. <span class="math inline">\(N\)</span> and find the place(s) where it crosses the <span class="math inline">\(x\)</span> axis (<span class="math inline">\(y = 0\)</span>).</li>
<li>Stability: if you start at some <span class="math inline">\(N\)</span> close to the fixed point but not exactly on it, will you go towards (stable) or away (unstable) from the fixed point? The sign of <span class="math inline">\(\frac{dN}{dt}\)</span> on either side of a fixed point tells you whether <span class="math inline">\(N\)</span> will increase or decrease in that area. Draw an arrow to the right if <span class="math inline">\(\frac{dN}{dt}\)</span> is positive, and draw an arrow to the left if <span class="math inline">\(\frac{dN}{dt}\)</span> is negative.</li>
</ul></li>
<li><p>Numerically solving differential equations in R: starting from an initial population size, calculate a sequence of population sizes using the information contained in the differential equation. The result is a <strong>trajectory</strong> of <span class="math inline">\(N\)</span> vs. time.</p>
<ul>
<li><strong>Euler’s method</strong>: starting from <span class="math inline">\(N_0\)</span>, find the rate of change of <span class="math inline">\(N\)</span> given by <span class="math inline">\(\frac{dN}{dt}\)</span> evaluated at <span class="math inline">\(N_0\)</span>. Approximate <span class="math inline">\(N_{0 + \Delta t}\)</span> using the following expression:</li>
</ul>
<p><span class="math display">\[N_{t+\Delta t} \approx N_t + \frac{dN}{dt} \Delta t\]</span> Use a <code>for</code> loop in R to calculate a series of <span class="math inline">\(N\)</span> at times of interest <span class="math inline">\(t\)</span>.</p>
<ul>
<li>Using R’s ODE-solver <code>ode</code>: define a function that calculates <span class="math inline">\(\frac{dN}{dt}\)</span> for your model, making sure that it’s in the correct format with arguments <code>t</code>, <code>state</code>, and <code>parameters</code>. Call the function <code>ode</code> and give it the parameters <code>y = state, times = times,    func = logistic_fn, parms = parameters</code></li>
</ul></li>
</ul>
</div>
<div id="finding-numerical-solutions-with-multiple-initial-conditions" class="section level2">
<h2>Finding numerical solutions with multiple initial conditions</h2>
<p>Let’s make a pretty plot of numerical solutions for the logistic equation from a few different starting points.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># define function to be in the format that `ode` uses</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">logistic_fn &lt;-<span class="st"> </span><span class="cf">function</span>(t, state, parameters) {</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="co"># Calculates dN/dt for the logistic equation</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="co"># t: time point at which to evaluate derivative</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="co"># state: vector of variables (here it&#39;s just N)</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="co"># parameters: vector of model parameters c(r, K)</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  N &lt;-<span class="st"> </span>state </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  r &lt;-<span class="st"> </span>parameters[<span class="st">&#39;r&#39;</span>] <span class="co"># get the element labelled &#39;r&#39;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  K &lt;-<span class="st"> </span>parameters[<span class="st">&#39;K&#39;</span>] <span class="co"># get the element labelled &#39;K&#39;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="co">#rate of change</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  dN &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span>N <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>N <span class="op">/</span><span class="st"> </span>K)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb1-17" data-line-number="17">  <span class="co">#return rate of change</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="kw">c</span>(dN)))</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">}</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Run ode</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">library</span>(deSolve)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># define parameters for the ode function</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">parameters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">r =</span> <span class="fl">0.5</span>, <span class="dt">K =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">initial_conditions &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">times &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co"># run ode inside a loop to calculate trajectories for several initial conditions</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">results &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">initial_conditions =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># CTRL-shift-m to make pipe</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="co"># &#39;do&#39; is a dplyr function that returns a dataframe after doing a series of computations.</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">  </span><span class="co"># once the results are in a data frame, everything we&#39;ve learned about ggplot and dplyr can be used!</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">  </span><span class="kw">do</span>(<span class="kw">data.frame</span>( <span class="co"># &#39;data.frame&#39; converts the output of &#39;ode&#39; to a dataframe</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    <span class="kw">ode</span>(</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">      <span class="dt">y =</span> initial_conditions, <span class="co"># each time the &#39;do&#39; loop runs, a new initial condition will be used</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">      <span class="dt">times =</span> times,</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">      <span class="dt">func =</span> logistic_fn,</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">      <span class="dt">parms =</span> parameters</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">      )</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">  ))</a>
<a class="sourceLine" id="cb2-24" data-line-number="24"></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co"># display the first few rows of the results</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="kw">head</span>(results)  </a></code></pre></div>
<pre><code>##   time       X1       X2       X3       X4 X5       X6       X7       X8
## 1 0.00 10.00000 20.00000 30.00000 40.00000 50 60.00000 70.00000 80.00000
## 2 0.01 10.04006 20.06003 30.05997 40.03994 50 59.94021 69.86063 79.76131
## 3 0.02 10.08024 20.12012 30.11988 40.07976 50 59.88083 69.72250 79.52522
## 4 0.03 10.12054 20.18027 30.17973 40.11946 50 59.82187 69.58560 79.29169
## 5 0.04 10.16096 20.24047 30.23951 40.15904 50 59.76332 69.44992 79.06069
## 6 0.05 10.20150 20.30074 30.29924 40.19850 50 59.70517 69.31544 78.83217</code></pre>
<p>This is exactly what we wanted. We have chosen a set of initial conditions (<code>seq(10, 80, by = 10)</code>) and created a dataframe that has one column of times (<code>time</code>) and a column for each trajectory resulting from each initial condition (<code>X1</code>, <code>X2</code>, …). Now we can use <code>ggplot</code> to plot all the trajectories.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># make a plot</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">    </span><span class="kw">gather</span>(Column, Value, <span class="op">-</span>time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> Value, <span class="dt">color =</span> Column)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> Value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Population size&quot;</span>)</a></code></pre></div>
<p><img src="lec08-stability_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>This plot very nicely summarizes the behaviour of the logistic equation: it shows the path that the population size <span class="math inline">\(N\)</span> will take in time from several initial conditions. Importantly, the carrying capacity <span class="math inline">\(K\)</span> which we set to be <span class="math inline">\(50\)</span> is clearly a stable fixed point: all the trajectories go towards <span class="math inline">\(K\)</span>.</p>
<div id="challenge" class="section level4">
<h4>Challenge</h4>
<p>Modify the plotting code above so that the legend lists the initial conditions for each line instead of <code>X1</code>, <code>X2</code>, etc.</p>
</div>
</div>
<div id="qualitative-analysis-of-2d-models" class="section level2">
<h2>Qualitative analysis of 2D models</h2>
<p>Now we’ll move on to look at how to analyze two-dimensional models. <strong>Two-dimensional</strong> means that there are now two variables in the system (like <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, prey and predators) instead of one (like <span class="math inline">\(N\)</span>).</p>
<p>Many of the concepts and tools from analyzing one-dimensional models will be used here as well, but we will add some things that are specific to more than one dimension.</p>
<p>To motivate some of these new concepts and the idea of modelling in two dimensions, let’s analyze a model of two species interacting.</p>
<p><span class="math display">\[\frac{dx}{dt} = ax - bxy\]</span> <span class="math display">\[\frac{dy}{dt} = cx - dy\]</span></p>
<p>This is very close to the Lotka-Volterra predator-prey model, but the term for predator growth is <span class="math inline">\(cx\)</span> instead of <span class="math inline">\(cxy\)</span>. In this model the predators will eat the prey at a constant rate, no matter how many of the predators there are. Make sure you don’t use these exact equations when you do the assignment!</p>
<p>First, we’ll simulate a trajectory for the two species.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">predator_prey &lt;-<span class="st"> </span><span class="cf">function</span>(t, y, parameters) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="co"># calculates dx/dt and dy/dt for a predator-prey model</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="co"># t: time at which to evaluate derivatives</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="co"># y: vector of system variables (c(X, Y))</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="co"># parameters: vector of model parameters (c(a, b, c, d))</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  <span class="co"># the arguments need to be named &quot;t&quot;, &quot;y&quot;, and &quot;parameters&quot;, otherwise this won&#39;t work with phaseR, a package we will use later</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  <span class="co">#now the state vector y has two elements because we have two species</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  X &lt;-<span class="st"> </span>y[<span class="dv">1</span>] <span class="co"># prey</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  Y &lt;-<span class="st"> </span>y[<span class="dv">2</span>] <span class="co"># predators</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  a &lt;-<span class="st"> </span>parameters[<span class="st">&#39;a&#39;</span>]</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  b &lt;-<span class="st"> </span>parameters[<span class="st">&#39;b&#39;</span>]</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  c &lt;-<span class="st"> </span>parameters[<span class="st">&#39;c&#39;</span>]</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">  d &lt;-<span class="st"> </span>parameters[<span class="st">&#39;d&#39;</span>]</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    </a>
<a class="sourceLine" id="cb5-19" data-line-number="19">  <span class="co"># calculate rate of change</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">  dx &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>X <span class="op">-</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>Y <span class="op">*</span><span class="st"> </span>X</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">  dy &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>X <span class="op">-</span><span class="st"> </span>d <span class="op">*</span><span class="st"> </span>Y</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb5-23" data-line-number="23">  <span class="co"># return rate of change</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="kw">c</span>(dx, dy)))</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">}</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># run the numerical solution</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">parameters =<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">1</span>, <span class="dt">c =</span> <span class="dv">1</span>, <span class="dt">d =</span> <span class="fl">0.2</span>) <span class="co"># parameters named so that we can access them by name</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">state &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">X =</span> <span class="dv">2</span>, <span class="dt">Y =</span> <span class="dv">2</span>) <span class="co"># same thing here</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">times &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">result &lt;-<span class="st"> </span><span class="kw">ode</span>(<span class="dt">y =</span> state, <span class="dt">times =</span> times, <span class="dt">func =</span> predator_prey, <span class="dt">parms =</span> parameters)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(result)</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># plot the results</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">result <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> X), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> Y), <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Population size&quot;</span>)</a></code></pre></div>
<p><img src="lec08-stability_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>It looks like we have oscillations that decay to a fixed point. Notice that the prey population (in red) dips below <span class="math inline">\(1\)</span> during each oscillation. If this was a real population, the prey would have gone extinct on the first dip below <span class="math inline">\(1\)</span>. This means that the parameters we’ve chosen aren’t very realistic. We could instead choose parameters that would change the fixed points to real-world population sizes.</p>
<div id="challenge-1" class="section level4">
<h4>Challenge</h4>
<p>Modify the plotting code above to include a legend distinguishing ‘predators’ and ‘prey’. Feel free to look up a solution online.</p>
</div>
<div id="a-note-on-using-eulers-method-to-solve-higher-dimensional-systems" class="section level3">
<h3>A note on using Euler’s method to solve higher-dimensional systems</h3>
<p><em>Note</em>: if you are using Euler’s method to solve a two-dimensional system, make sure you calculate the rates of change using the variables from the previous time step. For example, in the predator-prey model, both <span class="math inline">\(\Delta x\)</span> and <span class="math inline">\(\Delta y\)</span> depend on <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, and it’s important that you calculate <span class="math inline">\(\Delta x\)</span> and <span class="math inline">\(\Delta y\)</span> <em>before</em> updating the values of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</p>
<p>Here’s an example.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Define predator-prey equations</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">dX_dt &lt;-<span class="st"> </span><span class="cf">function</span>(X, Y, a, b) {</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="co"># X: number of prey</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="co"># Y: number of predators</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="co"># a: growth rate of prey</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="co"># b: rate at which predators eat prey</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  <span class="kw">return</span>(a <span class="op">*</span><span class="st"> </span>X <span class="op">-</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>Y <span class="op">*</span><span class="st"> </span>X)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">dY_dt &lt;-<span class="st"> </span><span class="cf">function</span>(X, Y, c, d) {</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="co"># X: number of prey</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="co"># Y: number of predators</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  <span class="co"># c: growth rate of predators from eating prey</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="co"># d: death rate for predators</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  <span class="kw">return</span> (c <span class="op">*</span><span class="st"> </span>X <span class="op">-</span><span class="st"> </span>d <span class="op">*</span><span class="st"> </span>Y)</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">}</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># parameters</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">a &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">b &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">c &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">d &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">state &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">X =</span> <span class="dv">2</span>, <span class="dt">Y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">dt &lt;-<span class="st"> </span><span class="fl">0.01</span> <span class="co"># timestep - the smaller, the better</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">tmax &lt;-<span class="st"> </span><span class="dv">30</span> <span class="co"># the total time we want to numerically solve for</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">points &lt;-<span class="st"> </span>tmax<span class="op">/</span>dt <span class="co"># the number of data points in the simulation - add 1 so that we can start at t=0</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co"># vectors to store values of X, Y, and t at each timestep:</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">X_vector &lt;-<span class="st"> </span><span class="kw">numeric</span>(points) <span class="co"># prey population size</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">Y_vector &lt;-<span class="st"> </span><span class="kw">numeric</span>(points) <span class="co"># predator population size</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">t_vector &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, tmax <span class="op">-</span><span class="st"> </span>dt, <span class="dt">by =</span> dt) <span class="co"># time vector</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co"># initial condition</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19">X0 &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20">Y0 &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21">X_vector[<span class="dv">1</span>] &lt;-<span class="st"> </span>X0</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">Y_vector[<span class="dv">1</span>] &lt;-<span class="st"> </span>Y0</a>
<a class="sourceLine" id="cb9-23" data-line-number="23"></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">X &lt;-<span class="st"> </span>X0 <span class="co"># initialize variable X</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25">Y &lt;-<span class="st"> </span>Y0 <span class="co"># initialize variable Y</span></a></code></pre></div>
<p>This is the right way to do it.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>points) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="co"># start at 2 because the initial state is at position 1</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="co"># first calculate BOTH dX and dY</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  dX &lt;-<span class="st"> </span><span class="kw">dX_dt</span>(<span class="dt">X =</span> X, <span class="dt">Y =</span> Y, <span class="dt">a =</span> a, <span class="dt">b =</span> b) <span class="op">*</span><span class="st"> </span>dt</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  dY &lt;-<span class="st"> </span><span class="kw">dY_dt</span>(<span class="dt">X =</span> X, <span class="dt">Y =</span> Y, <span class="dt">c =</span> c, <span class="dt">d =</span> d) <span class="op">*</span><span class="st"> </span>dt</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb10-8" data-line-number="8">  <span class="co"># now update BOTH X and Y</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  X &lt;-<span class="st"> </span>X <span class="op">+</span><span class="st"> </span>dX </a>
<a class="sourceLine" id="cb10-10" data-line-number="10">  Y &lt;-<span class="st"> </span>Y <span class="op">+</span><span class="st"> </span>dY</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  X_vector[i] &lt;-<span class="st"> </span>X</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  Y_vector[i] &lt;-<span class="st"> </span>Y</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">}</a></code></pre></div>
<p>This is the wrong way.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>points) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="co"># start at 2 because the initial state is at position 1</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="co"># calculate dX and then update X (wrong)</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  dX &lt;-<span class="st"> </span><span class="kw">dX_dt</span>(<span class="dt">X =</span> X, <span class="dt">Y =</span> Y, <span class="dt">a =</span> a, <span class="dt">b =</span> b) <span class="op">*</span><span class="st"> </span>dt</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  X <span class="op">&lt;</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>dX</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="co"># calculate dY and then update Y - this will use the new value of X instead of the old one.</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  dY &lt;-<span class="st"> </span><span class="kw">dY_dt</span>(<span class="dt">X =</span> X, <span class="dt">Y =</span> Y, <span class="dt">c =</span> c, <span class="dt">d =</span> d) <span class="op">*</span><span class="st"> </span>dt</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  Y &lt;-<span class="st"> </span>Y <span class="op">+</span><span class="st"> </span>dY</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  X_vector[i] &lt;-<span class="st"> </span>X</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  Y_vector[i] &lt;-<span class="st"> </span>Y</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">}</a></code></pre></div>
</div>
</div>
<div id="phase-portraits-in-two-dimensions" class="section level2">
<h2>Phase portraits in two dimensions</h2>
<div id="challenge-2" class="section level4">
<h4>Challenge</h4>
<p>What were the axes of the one-dimensional phase portraits we drew? What would the axes of a phase portrait for the predator-prey system above be?</p>
<p>Continuing with the predator-prey example: instead of plotting our numerical trajectory as <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> vs. <span class="math inline">\(t\)</span>, we’ll plot <span class="math inline">\(Y\)</span> vs. <span class="math inline">\(X\)</span>: predator population size vs. prey population size.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">ggplot</span>(result) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">color =</span> time)) <span class="co"># geom_line connects the dots in the wrong way - try it out and see</span></a></code></pre></div>
<p><img src="lec08-stability_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>A phase portrait in two dimensions has two axes: one for each of the variables in the system. Here, the two variables are <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, prey and predators. We want to include the same information in this 2D phase portrait as in the 1D portrait: at minimum, we want to mark the fixed points and draw a <strong>vector field</strong>: arrows indicating in which direction the rate of change is for different values of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>We can also add other information, and in the plot above we haven’t yet drawn arrows or fixed points, but we have drawn a <strong>trajectory</strong> - the dots trace out what happens to <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> over time starting from <span class="math inline">\(X = 2\)</span>, <span class="math inline">\(Y = 2\)</span>. Time is no longer an axis in the plot, but it’s still there, hidden in the path that the populations take.</p>
<p>Comparing these two ways of plotting a trajectory, we can see that oscillations in time look like circular motion in the phase portrait. The GIF below illustrates this.</p>
<div class="figure">
<img src="image/predator-prey.gif" alt="Predator-prey simulation" />
<p class="caption">Predator-prey simulation</p>
</div>
</div>
<div id="drawing-qualitative-phase-portraits-by-hand" class="section level3">
<h3>Drawing qualitative phase portraits by hand</h3>
<p>Before we look at how to add more to phase portraits in R, let’s practice the process by hand to get familiar with it. Let’s use the following two-dimensional system as an example. The two state variables are <span class="math inline">\(x\)</span> (position) and <span class="math inline">\(v\)</span> (velocity), and this is a model of a mass attached to a spring. <span class="math inline">\(dx/dt\)</span> is the rate of change of position, and <span class="math inline">\(dv/dt\)</span> is the rate of change of velocity.</p>
<p><span class="math display">\[\frac{dx}{dt} = v\]</span></p>
<p><span class="math display">\[\frac{dv}{dt} = -\omega^2 x\]</span></p>
<p>We want to draw a <strong>vector field</strong> in two dimensions to show how the system will evolve through time. Our axes are <span class="math inline">\(x\)</span> and <span class="math inline">\(v\)</span>. It doesn’t matter which one is the vertical axis and which one is horizontal, but let’s put <span class="math inline">\(x\)</span> on the x-axis and <span class="math inline">\(v\)</span> on the y-axis. These variables aren’t population sizes, so they can realistically be negative and non-integers.</p>
<p>Next, we choose some pairs of <span class="math inline">\(x\)</span> and <span class="math inline">\(v\)</span> and evaluate both <span class="math inline">\(dx/dt\)</span> and <span class="math inline">\(dv/dt\)</span>, drawing an arrow at <span class="math inline">\((x,v)\)</span> in the direction of the derivative. Let’s also set <span class="math inline">\(\omega = 1\)</span> for convenience. Let’s start with <span class="math inline">\((0,0)\)</span>: both derivatives are 0, so there’s no arrow. For <span class="math inline">\((0,1)\)</span>, <span class="math inline">\(dx/dt = 1\)</span> and <span class="math inline">\(dv/dt = 0\)</span>, so we draw an arrow pointing horizontally in the <span class="math inline">\(+x\)</span> direction. Similarly for <span class="math inline">\((1,0)\)</span>. For <span class="math inline">\((1,1)\)</span>, we draw an arrow that goes <span class="math inline">\(1\)</span> unit in the <span class="math inline">\(x\)</span> direction and <span class="math inline">\(-1\)</span> unit in the <span class="math inline">\(y\)</span> direction. As we keep filling in this grid, we start to get a picture of how the system can behave for different starting points of <span class="math inline">\(x\)</span> and <span class="math inline">\(v\)</span>.</p>
<p>This is analogous to plotting <span class="math inline">\(dN/dt\)</span> vs. <span class="math inline">\(N\)</span> and drawing arrows to the right where <span class="math inline">\(dN/dt\)</span> is positive and arrows to the left when it’s negative, except that now we have to consider that the rate of change is affecting both variables at the same time.</p>
<div id="challenge-3" class="section level4">
<h4>Challenge</h4>
<p>Define a function called <code>mass_spring</code> that uses the format required by <code>ode</code> to calculate and return <span class="math inline">\(dx/dt\)</span> and <span class="math inline">\(dv/dt\)</span>. We will use this function later to plot a phase portrait in R. Remember that the arguments for your function must be called <code>t</code>, <code>y</code>, and <code>parameters</code>.</p>
</div>
</div>
<div id="using-phaser-to-draw-phase-portraits-in-r" class="section level3">
<h3>Using <code>phaseR</code> to draw phase portraits in R</h3>
<p><code>phaseR</code> is a package specifically for drawing phase portraits. It can automatically calculate and plot things like trajectories and vector fields.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">library</span>(phaseR)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">?phaseR</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">?flowField <span class="co"># the nice thing about this packages is that it takes functions in the same format as `ode`</span></a></code></pre></div>
<p>Let’s plot a vector field and some trajectories for the predator-prey model.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># plot vector field: on a grid of points, plot an arrow in the direction of dx/dt and dy/dt</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">pp_flowField &lt;-<span class="st"> </span><span class="kw">flowField</span>(predator_prey, <span class="dt">x.lim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">y.lim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                          <span class="dt">parameters =</span> <span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">1</span>, <span class="dt">c =</span> <span class="dv">1</span>, <span class="dt">d =</span> <span class="fl">0.2</span>), <span class="co"># same parameters as before,</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">                          <span class="dt">points =</span> <span class="dv">15</span>, <span class="co"># this is the density of grid points on which to plot arrows</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                          <span class="dt">system =</span> <span class="st">&#39;two.dim&#39;</span>, <span class="co"># &#39;two.dim&#39; is default</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">                          <span class="dt">add =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co"># add trajectories</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">pp_trajectory &lt;-<span class="st"> </span><span class="kw">trajectory</span>(predator_prey, </a>
<a class="sourceLine" id="cb16-10" data-line-number="10">                            <span class="co"># y0 is a matrix where each row is pairs of (X, Y) </span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">                            <span class="dt">y0 =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">8</span>), <span class="dt">ncol =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">                                   <span class="dt">byrow =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb16-13" data-line-number="13">                            <span class="dt">t.end =</span> <span class="dv">20</span>, <span class="co"># how far in time to calculate the trajectories</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">                            <span class="dt">parameters =</span> <span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">1</span>, <span class="dt">c =</span> <span class="dv">1</span>, <span class="dt">d =</span> <span class="fl">0.2</span>), <span class="dt">system =</span> <span class="st">&quot;two.dim&quot;</span>)</a></code></pre></div>
<p><img src="lec08-stability_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>## [1] &quot;Note: colour has been reset as required&quot;</code></pre>
<div id="challenge-4" class="section level4">
<h4>Challenge</h4>
<p>Use <code>phaseR</code> and the function <code>flowField</code> to make a phase portrait for the mass-spring system of differential equations. You will need to use the function you wrote in the previous challenge. Is there a fixed point, and if so, where do you think it is?</p>
</div>
</div>
</div>
<div id="finding-fixed-points-analytically-time-permitting" class="section level2">
<h2>Finding fixed points analytically (time permitting)</h2>
<p>Up until now we’ve been plotting <span class="math inline">\(\frac{dN}{dt}\)</span> vs. <span class="math inline">\(N\)</span> to find the fixed points of a system. But we can also solve <span class="math inline">\(\frac{dN}{dt}\)</span> <span class="math inline">\(=0\)</span> analytically to find the fixed points. One advantage of finding the fixed points analytically is that you can see how the fixed points depend on the model parameters, whereas before we had to choose parameters in order to plot <span class="math inline">\(\frac{dN}{dt}\)</span> and find the fixed points qualitatively.</p>
<p><span class="math display">\[\frac{dN}{dt} = rN(1-\frac{N}{K})\]</span></p>
<p>First, we set <span class="math inline">\(\frac{dN}{dt}\)</span> <span class="math inline">\(=0\)</span>.</p>
<p><span class="math display">\[0 = rN(1-\frac{N}{K})\]</span></p>
<p>Next, we find all the values of <span class="math inline">\(N\)</span> that satisfy this equation. If either <span class="math inline">\(rN = 0\)</span> or <span class="math inline">\(1-\frac{N}{K} = 0\)</span>, the equation is satisfied. This means we have two fixed points, one at <span class="math inline">\(N = 0\)</span> (since <span class="math inline">\(r \neq 0\)</span>) and the other at <span class="math inline">\(N = K\)</span>. These are the same fixed points we found graphically last week. Notice that one of the fixed points depends on <span class="math inline">\(K\)</span>, but that neither of the fixed points depend on <span class="math inline">\(r\)</span>.</p>
<div id="challenge-5" class="section level4">
<h4>Challenge</h4>
<p>Find the fixed point(s) of the following differential equation:</p>
<p><span class="math display">\[\frac{dx}{dt} = x^2 - 1\]</span></p>
<ul>
<li>First find the fixed points analytically on paper.</li>
<li>Plot <span class="math inline">\(\frac{dx}{dt}\)</span> vs. <span class="math inline">\(x\)</span> for <span class="math inline">\(x\)</span> ranging from <span class="math inline">\(-2\)</span> to <span class="math inline">\(2\)</span> in <span class="math inline">\(0.1\)</span> increments.</li>
<li>Sketch a phase portrait. Are the fixed point(s) stable or unstable?</li>
</ul>
</div>
</div>
<div id="extras" class="section level2">
<h2>Extras</h2>
<p>Predator-prey simulation GIF in R</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">library</span>(animation)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="kw">ani.options</span>(<span class="dt">interval =</span> <span class="fl">0.00001</span>)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">parameters =<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">1</span>, <span class="dt">c =</span> <span class="dv">1</span>, <span class="dt">d =</span> <span class="fl">0.2</span>) </a>
<a class="sourceLine" id="cb18-9" data-line-number="9">state &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">X =</span> <span class="dv">2</span>, <span class="dt">Y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">times &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb18-11" data-line-number="11"></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">result &lt;-<span class="st"> </span><span class="kw">ode</span>(<span class="dt">y =</span> state, <span class="dt">times =</span> times, <span class="dt">func =</span> predator_prey, <span class="dt">parms =</span> parameters)</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">result &lt;-<span class="st"> </span><span class="kw">data.frame</span>(result)</a>
<a class="sourceLine" id="cb18-14" data-line-number="14"></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw">saveGIF</span>({ </a>
<a class="sourceLine" id="cb18-16" data-line-number="16">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">length</span>(result<span class="op">$</span>time), <span class="dt">by =</span> <span class="dv">50</span>)) { </a>
<a class="sourceLine" id="cb18-17" data-line-number="17">      result_i &lt;-<span class="st"> </span><span class="kw">head</span>(result, i)</a>
<a class="sourceLine" id="cb18-18" data-line-number="18">      p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(result_i) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="st">        </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> result_i<span class="op">$</span>time, <span class="dt">y =</span> result_i<span class="op">$</span>X), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="st">        </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> result_i<span class="op">$</span>time, <span class="dt">y =</span> result_i<span class="op">$</span>Y), <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="st">        </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="st">        </span><span class="kw">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Population size&quot;</span>)</a>
<a class="sourceLine" id="cb18-24" data-line-number="24"></a>
<a class="sourceLine" id="cb18-25" data-line-number="25">      p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(result_i) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="st">        </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> result_i<span class="op">$</span>X, <span class="dt">y =</span> result_i<span class="op">$</span>Y, <span class="dt">color =</span> result_i<span class="op">$</span>time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="st">        </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="st">        </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30"><span class="st">        </span><span class="kw">xlab</span>(<span class="st">&quot;Prey population size X&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-31" data-line-number="31"><span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Predator population size Y&quot;</span>)</a>
<a class="sourceLine" id="cb18-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb18-33" data-line-number="33">    <span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">top =</span> <span class="st">&quot;Predator-prey model&quot;</span>)</a>
<a class="sourceLine" id="cb18-34" data-line-number="34">    }</a>
<a class="sourceLine" id="cb18-35" data-line-number="35"></a>
<a class="sourceLine" id="cb18-36" data-line-number="36">}, <span class="dt">movie.name =</span> <span class="st">&quot;image/predator-prey.gif&quot;</span>, <span class="dt">ani.width =</span> <span class="dv">900</span>, <span class="dt">ani.height =</span> <span class="dv">600</span>)</a></code></pre></div>
</div>


<hr>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. See the <a href="LICENSE.html">licensing</a> page for more details about copyright information.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
